<!DOCTYPE html>
<html>
  <head>
    <title>Test Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <style>
        #map {
            height: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyDm-CjjiXApIMZHI2oS1BC-oyCCyayvwR4",
            authDomain: "innovaone-hackaubg.firebaseapp.com",
            databaseURL: "https://innovaone-hackaubg-default-rtdb.firebaseio.com",
            projectId: "innovaone-hackaubg",
            storageBucket: "innovaone-hackaubg.appspot.com",
            messagingSenderId: "678444236582",
            appId: "1:678444236582:web:339e2f6b6a9a6c6fc98be7",
            measurementId: "G-L9BQXSZQB6"
        };

        firebase.initializeApp(firebaseConfig);

        function initMapDemo() {
            var heatmapData = [];

            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 1000; j++) {
                    heatmapData.push({ location: new google.maps.LatLng(47.6199618 + i / 10000 , -122.3426807 + j / 75000), weight: 0.05 });
                }
            }

            var seattle = new google.maps.LatLng(47.6199618,-122.3426807);

            map = new google.maps.Map(document.getElementById('map'), {
                center: seattle,
                zoom: 15,
                mapTypeId: 'satellite'
            });

            var heatmap = new google.maps.visualization.HeatmapLayer({
                data: heatmapData
            });
            heatmap.setMap(map);
        }

        function initMapFirebase(heatmapData) {
            var coords = [41.6229474,24.1651491];
            var dospat = new google.maps.LatLng(coords[0],coords[1]);
            map = new google.maps.Map(document.getElementById('map'), {
                center: dospat,
                zoom: 13.5,
                mapTypeId: 'satellite'
            });

            var heatmap = new google.maps.visualization.HeatmapLayer({
                data: heatmapData
            });

            heatmap.setMap(map);
        }

        function initMap() {
            var database = firebase.database();
            var starCountRef = firebase.database().ref('geo/');
            starCountRef.on('value', (snapshot) => {
                var heatmapData = [];

                const data = snapshot.val();
                Object.keys(data).forEach((geo) => {
                    console.log([data[geo].lat, data[geo].lng]);
                    heatmapData.push({ location: new google.maps.LatLng(data[geo].lat, data[geo].lng), weight: 0.5 });
                })

                initMapFirebase(heatmapData)
            });
        }
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDm-CjjiXApIMZHI2oS1BC-oyCCyayvwR4&callback=initMap&libraries=visualization&v=weekly"
      async
    ></script>
  </body>
</html>